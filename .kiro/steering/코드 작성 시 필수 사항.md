# 코드 작성 시 필수 사항

## 로깅

### 로그 레벨 설정
- 모든 애플리케이션은 환경 변수로 로그 레벨을 조정할 수 있어야 함
- 환경 변수명: `LOG_LEVEL`
- 지원 레벨: `DEBUG`, `INFO`, `WARNING`, `ERROR`
- 기본값: `INFO` (프로덕션), `DEBUG` (개발)

### 로그 출력 규칙
- 모든 API 요청/응답은 로깅
- 에러 발생 시 스택 트레이스 포함 (DEBUG 모드)
- 민감 정보(비밀번호, 토큰 등)는 로그에 출력 금지
- AWS 자격증명 설정 여부만 표시 (값은 출력 안 함)

### 구현 예시
```python
import logging
import os

LOG_LEVEL = os.getenv("LOG_LEVEL", "INFO").upper()
logging.basicConfig(
    level=getattr(logging, LOG_LEVEL),
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)
```

## Docker

### 환경 변수
- 모든 설정은 환경 변수로 주입 가능해야 함
- 기본값은 개발 환경 기준으로 설정
- `.env` 파일 지원

### 볼륨 마운트
- 개발 시 코드 변경 자동 반영을 위해 소스 디렉토리 마운트
- AWS 자격증명은 `~/.aws:/root/.aws:ro` (읽기 전용)

### 헬스체크
- 모든 서비스는 `/health` 엔드포인트 제공
- Docker 헬스체크 설정 필수

## API 설계

### 에러 응답
- 명확한 에러 타입과 메시지 포함
- HTTP 상태 코드 적절히 사용
  - 400: 잘못된 요청
  - 403: 권한 부족
  - 500: 서버 에러
- 에러 상세 정보는 DEBUG 모드에서만 노출

### 응답 형식
- 일관된 JSON 구조 사용
- 타임스탬프, 리전, 계정 정보 포함

## AWS 연동

### 자격증명
- 환경 변수 우선: `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`
- 없으면 `~/.aws/credentials` 파일 사용
- IAM Role 지원 (ECS 배포 시)

### 에러 처리
- `NoCredentialsError`: 자격증명 없음
- `AccessDenied`: 권한 부족
- `InvalidClientTokenId`: 잘못된 자격증명
- 각 에러별 명확한 메시지 제공

## 테스트

### 필수 테스트
- Unit Test: pytest
- Property-Based Test: hypothesis (최소 100회 반복)
- E2E Test: moto로 AWS 모킹

### 실행 방법
```bash
# 전체 테스트
uv run pytest

# 특정 테스트만
uv run pytest tests/test_api.py

# 커버리지 포함
uv run pytest --cov=app
```

## 타입 힌트

### 필수 사항
- 모든 함수/메서드에 타입 힌트 작성
- Python 3.11+ 문법 사용 (`list[str]`, `dict[str, Any]`)
- mypy strict 모드 통과

### 검증
```bash
uv run mypy app/ --strict
```

## 문서화

### README
- 100줄 이내로 간결하게
- Quick Start 섹션 필수
- 명령어 중심으로 작성

### API 문서
- FastAPI 자동 문서 활용 (`/docs`, `/redoc`)
- 각 엔드포인트에 설명 추가
- Request/Response 예시 포함

## 보안

### 민감 정보
- 환경 변수로 주입
- 코드에 하드코딩 금지
- 로그에 출력 금지

### Docker
- 읽기 전용 볼륨 사용 (`:ro`)
- 최소 권한 원칙
- 프로덕션에서는 CORS 제한

## 성능

### boto3
- 클라이언트 재사용
- 페이지네이션 처리
- 타임아웃 설정 (기본 30초)

### API
- 비동기 처리 (FastAPI async)
- 적절한 캐싱
- Rate Limiting 고려
